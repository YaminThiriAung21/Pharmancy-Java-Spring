<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="pec.mapper.SupplierWrapperMapper">
	<select id="getProductList" resultType="pec.dto.SupplierWrapperDto">
		select 
		product_info_id,
		product_code,
		product_name,
		medicine_type,
        category_name,
        packaging_type,
		buy_price 
		from product_info inner join medicine_info on medicine_info.medicine_info_id=product_info.medicine_info_id 
		inner join category_info on category_info.category_info_id=product_info.category_info_id
		inner join packaging_info on packaging_info.packaging_info_id=product_info.packaging_info_id
		where product_info.delete_flag='0' and product_info.office_info_id = #{office_info_id} 
		order by product_info.product_info_id ASC
	</select>
	<select id="addToOrder" parameterType="int" resultType="pec.dto.SupplierWrapperDto">
     select 
		product_info_id,
		product_code,
		product_name,
		medicine_type,
        category_name,
        packaging_type,
		buy_price 
		from product_info inner join medicine_info on medicine_info.medicine_info_id=product_info.medicine_info_id 
		inner join category_info on category_info.category_info_id=product_info.category_info_id
		inner join packaging_info on packaging_info.packaging_info_id=product_info.packaging_info_id
      WHERE product_info_id = #{product_info_id} 
   </select>
   <select id="getSupplierName" parameterType="int" resultType="pec.dto.SupplierWrapperDto">
     select
     *
     from supplier_info where delete_flag='0'
   </select>
    <insert id="addDetail" parameterType="pec.dto.SupplierWrapperDto">
           insert into supplier_detail_order_info(product_info_id,expire_date,
           product_price,product_quantity,product_total_price,supplier_order_info_id,insert_user,
           insert_date,update_user,update_date,manufacture_date)
           values(#{product_info_id},#{expire_date},#{product_price},#{product_quantity},
           #{product_total_price},#{supplier_order_info_id},#{insert_user},#{insert_date},
           #{update_user},#{update_date},#{manufacture_date})
     
     </insert>
   <insert id="addOrderInfo" parameterType="pec.dto.SupplierOrderInfoDto">
           <selectKey resultType="int" keyProperty="supplier_order_info_id" order="AFTER">
			SELECT MAX(supplier_order_info_id) FROM supplier_order_info
			</selectKey>
           insert into supplier_order_info(supplier_info_id,order_receive_date,total_price,office_info_id,insert_user,insert_date,update_user,update_date,order_date) values((select supplier_info_id from supplier_info where supplier_name=#{supplier_name}),#{order_receive_date},#{total_price},#{office_info_id},
           #{insert_user},#{insert_date},#{update_user},#{update_date},#{order_date})
           
     
     </insert>
</mapper>