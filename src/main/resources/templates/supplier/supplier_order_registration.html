<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
	layout:decorator="common/admin_layout">
<head>
<meta charset="ISO-8859-1">
<title>Supplier Order Registration</title>
<style type="text/css">
.hidden {
  display: none;
}
.modal-backdrop {
	z-index: -1;
}
$quantity-btn-color: #95d7fc ;
.form-group {
	width: 10%;
	margin: 30px; input [type="text"] { width : 100%;
	text-align: right;
}

.glyphicon {
	color: $quantity-btn-color;
}
}
</style>
</head>
<style>



</style>

<body>
	<div class="col-lg-12" layout:fragment="content">

		<p id="errorMsg" th:if="${errormsg != null}" th:text="${errormsg}"
			class="sufee-alert alert with-close alert-success alert-dismissible fade show"></p>
		<p id="successMsg" th:if="${msg != null}" th:utext="${msg}"
			class="sufee-alert alert with-close alert-success alert-dismissible fade show"></p>
			
		
		
		<form th:action="@{${T(pec.datacode.AdminPageInfo).SUPPLIER_ORDER_REGISTRATION.url}}"
						method="get" class="form-horizontal" name="myForm">
			<div id="ordercheck" class="alert alert-danger hidden" data-alert="alert" style="top: 0">
				<button class="float-right" onclick="return closing()">&times;</button>
				<p>
					<strong>Please Check</strong> the check box you add to order
				</p>
			</div>
			
					
		
			<div class="card">
				<div class="card-header text-center">
						<strong>Supplier Order </strong>Registration 
				</div>
                
						

				<div class="card-body card-block">
					<div class="row form-group">
						<div class="col col-md-3">
							<label for="select" class=" form-control-label">Supplier
								Name</label>
						</div>
						<div class="col-6 col-md-3">

							<select class="form-control" th:field="${supplierOrderWrapperDto.supplierOrderInfoDto.supplier_name}">
	                			<option th:each="supDto:${supplierdropdown}" th:value="${supDto.supplier_name}" th:text="${supDto.supplier_name}"></option>  
	                			
                            </select>
						</div>
					</div>
					
					<div class="row form-group">
						<div class="col col-md-3">
							<label for="hf-email" class=" form-control-label">Order Submit Date:</label>
						</div>
						<div class="col-6 col-md-3">
							<input type="date" id="today" placeholder="yyyy-MM-dd" th:field="${supplierOrderWrapperDto.supplierOrderInfoDto.order_date}"
								th:value="${{supplierOrderWrapperDto.supplierOrderInfoDto.order_date}}" class="form-control" readonly> 
						</div>

						<div class="col col-md-3">
							<label for="hf-password" class=" form-control-label">Order
								Received Date:</label>
						</div>
						
						<div class="col-12 col-md-3">
							<input type="date" th:attr="min=${min}" id="orderReceivedDate" th:field="${supplierOrderWrapperDto.supplierOrderInfoDto.order_receive_date}"
								th:value="${{supplierOrderWrapperDto.supplierOrderInfoDto.order_receive_date}}" placeholder="yyyy-MM-dd" class="form-control" onchange="clearErrorMsg()"> 
								<span class="help-block" id="orderReceiveDate_msg"></span>
						</div>
					</div>
					<br>
					<div th:object="${supplierOrderWrapperDto}">
						<div th:each="dto, ind: *{supplierOrderList}">
						<hr style="border-top: 1px dotted green"> 
						    <div class="row form-group">
								<div class="col col-md-3"  style="color: #0687BF;font-size:20px;">
									<strong>Product Order <label th:text="${ind.count}"></label></strong>
								</div>
								<div class="col col-md-7"></div>
								<input type="hidden" id="rowIndex" th:field="${supplierOrderWrapperDto.supplierOrderInfoDto.rowIndex}">
								<div class="col col-md-2">
									
									<button type="submit" name="remove" class="btn btn-danger btn-sm" th:id="${ind.index}"
									onclick="return clearingcontent(this.id);" >Remove Order</button>
								</div>
						    </div>
						<div class="row form-group">
							<div class="col col-md-3">
								<label for="hf-email" class=" form-control-label">Product
									Code:</label>
							</div>
							<input type="hidden" th:name="supplierOrderList[__${ind.index}__].product_info_id" th:value="${dto.product_info_id}" />
							<div class="col-6 col-md-3">
								<input type="text" placeholder="(empty)" class="form-control"
								th:id="product_code+${ind.index}" th:name="supplierOrderList[__${ind.index}__].product_code"
								th:value="${dto.product_code}" onchange="clearErrorMsg()" readonly> 
								
							</div>
	
							<div class="col col-md-3">
								<label for="hf-password" class=" form-control-label">Product
									Name:</label>
							</div>
							<div class="col-12 col-md-3">
								<input type="text" placeholder="(empty)" class="form-control" 
								th:id="product_name+${ind.index}" th:name="supplierOrderList[__${ind.index}__].product_name"
								th:value="${dto.product_name}" readonly> 
								
							</div>
						</div>
						<div class="row form-group">
							<div class="col col-md-3">
							<label for="hf-email" class=" form-control-label">Category Type:</label>
							</div>
							<div class="col-6 col-md-3">
							<input type="text" placeholder="(empty)" class="form-control"
							th:id="category_name+${ind.index}" th:name="supplierOrderList[__${ind.index}__].category_name"
							th:value="${dto.category_name}" readonly>
							</div>
							
							<div class="col col-md-3">
							<label for="hf-email" class=" form-control-label">Medicine Type:</label>
							</div>
							<div class="col-12 col-md-3">
							<input type="text" placeholder="(empty)" class="form-control"
							th:id="medicine_type+${ind.index}" th:name="supplierOrderList[__${ind.index}__].medicine_type"
							th:value="${dto.medicine_type}" readonly>
							
							</div>
						</div>
						<div class="row form-group">
							<div class="col col-md-3">
								<label for="hf-password" class=" form-control-label">Packaging
									Type:</label>
							</div>
							<div class="col-6 col-md-3">
								<input type="text" placeholder="(empty)" class="form-control" 
								th:id="packaging_type+${ind.index}" th:name="supplierOrderList[__${ind.index}__].packaging_type"
								th:value="${dto.packaging_type}" readonly> 
								
							</div>
						</div>
						<div class="row form-group">
							<div class="col col-md-3">
								<label for="hf-email" class=" form-control-label">Product
									Quantity:</label>
							</div>
	
							<div class="col-6 col-md-3">
								<div class="input-group mb-3" style="max-width: 200px;">
									<div class="input-group-prepend">
										<button class="btn btn-outline-primary"
										type="button" th:id="${ind.index}" onClick="minus_click(this.id)">&minus;</button>
								    </div>
								    <input type="text" id="productQuantity" class="form-control text-center" placeholder="" th:name="supplierOrderList[__${ind.index}__].product_quantity"
									  aria-label="Example text with button addon" th:value="${dto.product_quantity}"
									 th:id= "product_quantity+ ${ind.index}" aria-describedby="button-addon1" readonly >
									
   									<div class="input-group-append">
										<button class="btn btn-outline-primary"
										type="button" th:id="${ind.index}" onClick="plus_click(this.id)">&plus;</button>
									</div>
								</div>

								</div>
							
							<!-- <div class="number">
							<span class="minus">-</span>
							<input type="text" value="1"/>
							<span class="plus">+</span>
						</div>  -->
							<div class="col col-md-3">
								<label for="hf-email" class=" form-control-label">Product
									Price:</label>
							</div>
							<div class="col-12 col-md-3">
								<input type="text" placeholder="Enter Product Price..." class="form-control" 
								th:id="buy_price+${ind.index}" th:name="supplierOrderList[__${ind.index}__].buy_price"
								th:value="${dto.buy_price}" readonly> 
									
							</div>
						</div>
						<input type="hidden" th:id="product_total_price+${ind.index}" th:name="supplierOrderList[__${ind.index}__].product_total_price" th:value="${dto.product_total_price}">
						<div class="row form-group">
							<div class="col col-md-3">
								<label for="hf-password" class=" form-control-label">Manufacture Date:</label>
							</div>
							<div class="col-6 col-md-3">
								<input type="date" th:attr="max=${max}" th:id="manufactureDate+${ind.index}" placeholder="yyyy-MM-dd" th:value="${{dto.manufacture_date}}" 
								th:name="supplierOrderList[__${ind.index}__].manufacture_date" onchange="clearErrorMsg()"
								class="form-control"> 
								<span class="help-block" th:id="manufactureDate_msg+${ind.index}"></span>
							</div>
	
	
							<div class="col col-md-3">
								<label for="hf-password" class=" form-control-label">Expired Date:</label>
							</div>
							<div class="col-12 col-md-3">
								<input type="date" th:attr="min=${min}" th:id="expiredDate+${ind.index}" placeholder="yyyy-MM-dd" th:value="${{dto.expire_date}}" 
								th:name="supplierOrderList[__${ind.index}__].expire_date" class="form-control" 
								onchange="clearErrorMsg()">
								<span class="help-block" th:id="expiredDate_msg+${ind.index}"></span> 
							</div>
						</div>
						
						</div>
						 
					</div>
					<br>
					<hr size=2 noshade>
					<div class="row form-group">
						<div class="col col-md-3"></div>
						<div class="col-6 col-md-3"></div>
						<div class="col col-md-3">
							<label for="hf-email" class=" form-control-label">Total
								Price:</label>
						</div>
						<div class="col-12 col-md-3">
							<input type="text" placeholder="0"
								class="form-control" id="total_price" th:field="${supplierOrderWrapperDto.supplierOrderInfoDto.total_price}"  readonly> 
						</div>
					</div>
					<div class="row form-group">
						<div class="col col-md-5"></div>
						<div class="col-7 col-md-2">
							<button type="submit" name="order" class="btn btn-info btn-sm" th:if="${orderListSize>0}"
								onclick="return checkValidate()">Order</button>
						</div>
						<div class="col col-md-2">
							<button type="submit" name="clear" class="btn btn-danger btn-sm"
							onClick="clear()">Clear</button>
						</div>
					</div>
		
					
		                <hr size=2 noshade>
						<!-- <div class="row m-t-30">
							<div class="col-md-12"> -->
							
								<!-- DATA TABLE-->
								
								<h6 class="text-center"><strong>Product </strong>List</h6>
								
									<table id="list" class="table-responsive m-b-40 table table-borderless table-data3">
										<thead>
											<tr>
												<th></th>
												<th>No</th>
												<th>Product Code</th>
												<th>Product Name</th>
												<th>Medicine Type</th>
												<th>Category Type</th>
												<th>Packaging Type</th>
												<th>Product Price</th>
												
											</tr>
										</thead>
										<tbody>

											<tr th:each="dto, ind: ${supplierOrderWrapperDto.productList}" class="active">
												<td><input type="checkbox" name="row-check"
													id="row-check" th:value=${dto.product_info_id}></td>
												<td th:text="${ind.count}"></td>
												<td th:text="${dto.product_code}"></td>
												<td th:text="${dto.product_name}"></td>
												<td th:text="${dto.medicine_type}"></td>
												<td th:text="${dto.category_name}"></td>
												<td th:text="${dto.packaging_type}"></td>
												<td th:text="${dto.buy_price}"></td>
												
											</tr>
										</tbody>
									</table>
								
								</div>
								<!-- END DATA TABLE-->
							<!-- </div>
						</div> -->
						
							<div class="card-footer" align="right">
							<div class="card-block float-right">
							
							<button type="submit" name="addTo" id="btnOrder"
									class="btn btn-info btn-sm" onclick="return orderCheck()">Add to Order</button>
							</div>
							</div>
						
						
						</div>
						</form>
				</div>
			
	

		
			<script type="text/javascript" layout:fragment="scriptArea">	
			
			
      
			 function clearErrorMsg(){	
				
				
				var errorMsg = document.getElementById("errorMsg");
				var successMsg = document.getElementById("successMsg");
				if(errorMsg != null){
					document.getElementById("errorMsg").style.visibility = "hidden";
					document.getElementById("errorMsg").innerHTML = "";
					document.getElementById("errorMsg").classList.remove("alerterror");
				}
				if(successMsg != null){
					document.getElementById("successMsg").style.visibility = "hidden";
					document.getElementById("successMsg").innerHTML = "";
					document.getElementById("successMsg").classList.remove("alertsuccess");
				}
				
				document.getElementById("orderReceivedDate").style.borderColor = "";
				document.getElementById("orderReceiveDate_msg").innerHTML = "";
				
				var orderSize="[[${orderListSize}]]";
				/* alert("size"+orderSize); */
				for (i = 0; i < orderSize; i++) {
					
				document.getElementById("manufactureDate"+i).style.borderColor = "";
				document.getElementById("manufactureDate_msg"+i).innerHTML = "";
			
				document.getElementById("expiredDate"+i).style.borderColor = "";
				document.getElementById("expiredDate_msg"+i).innerHTML = "";
				}
				
			}
			function checkValidate(){	
				
				var orderReceiveDateMsg="[[${E000034}]]";
				var manufactureDateMsg="[[${E000031}]]";
				var expiredDateMsg="[[${E000032}]]";
			  
			     
				var orderreceiveDate = document.getElementById("orderReceivedDate").value.trim();
				if(orderreceiveDate == ""){
					document.getElementById("orderReceivedDate").style.borderColor = "red";
					document.getElementById("orderReceiveDate_msg").innerHTML = orderReceiveDateMsg;
				    return false;
				}
				
				var orderSize="[[${orderListSize}]]";
				 
				for (i = 0; i < orderSize; i++) {
					
				var manufactureDate = document.getElementById("manufactureDate"+ i).value.trim();
				var expired_date = document.getElementById("expiredDate"+ i).value.trim();
				
				if(manufactureDate== ""){
					document.getElementById("manufactureDate"+i).style.borderColor = "red";
					document.getElementById("manufactureDate_msg"+i).innerHTML = manufactureDateMsg;
				    return false;
				}
				else if(expired_date == ""){
					document.getElementById("expiredDate"+i).style.borderColor = "red";
					document.getElementById("expiredDate_msg"+i).innerHTML = expiredDateMsg;
				    return false;
				}
				
				}
			
				return true;
				
				
			} 
			
				
			
			function clearingcontent(id){
				document.getElementById("rowIndex").value = id;
				return true;
				
      		}
			
			let today = new Date().toISOString().substr(0, 10);
			document.querySelector("#today").value = today;
			
			
			/* $(function() {

				// Header Master Checkbox Event
				$("#masterCheck").on( "click",
					function() {
						if ($("input:checkbox").prop("checked")) {
							$("input:checkbox[name='row-check']").prop("checked", true);
						} else {
							$("input:checkbox[name='row-check']").prop("checked", false);
						}
					});

				// Check event on each table row checkbox
				$("input:checkbox[name='row-check']").on("change",
					function() {
						var total_check_boxes = $("input:checkbox[name='row-check']").length;
						var total_checked_boxes = $("input:checkbox[name='row-check']:checked").length;
						
						// If all checked manually then check master checkbox
						if (total_check_boxes === total_checked_boxes) {
							$("#masterCheck").prop("checked", true);
						} else {
							$("#masterCheck").prop("checked", false);
						}
					});
			});  */
			var orderSize="[[${orderListSize}]]";	
			/* alert('Order Size'+orderSize) */
			var sub_total = 0;
			for (i = 0; i < orderSize; i++) {
				var total_price = document.getElementById("product_total_price" + i).value;
				sub_total = parseInt(total_price) + parseInt(sub_total); 		
					
			}
			console.log('sub total price'+sub_total)
			 document.getElementById("total_price").value = sub_total;



			function minus_click(clicked_id)
			{	
				var quan = document.getElementById("product_quantity" + clicked_id).value;
				/* alert('Product QTY'+quan) */
				if(quan > 1){
					document.getElementById("product_quantity" + clicked_id).value= parseInt(quan)-1 ;
				    var price = document.getElementById("buy_price" + clicked_id).value;
				    /* alert('Product Price'+price) */
				    document.getElementById("product_total_price"+ clicked_id).value = document.getElementById("product_quantity" + clicked_id).value * price;
					
				} 
				
				var sub_total = 0;
				var orderSize="[[${orderListSize}]]";	
				/* alert('Order Size'+orderSize) */
				for (i = 0; i < orderSize; i++) {
					var total_price = document.getElementById("product_total_price" + i).value;
					sub_total = parseInt(total_price) + parseInt(sub_total); 	
						
				}
				/* alert('total_price'+sub_total) */
				 document.getElementById("total_price").value = sub_total;

				}
				
			function plus_click(clicked_id)
			{	
				var quant = document.getElementById("product_quantity" + clicked_id).value;
				if(quant < 100){
					document.getElementById("product_quantity" + clicked_id).value= parseInt(quant)+1 ;
				    var price = document.getElementById("buy_price" + clicked_id).value;
				    document.getElementById("product_total_price"+ clicked_id).value = document.getElementById("product_quantity" + clicked_id).value * price;
					
				}
				var sub_total = 0;
				var orderSize="[[${orderListSize}]]";	
				/* alert('Order Size'+orderSize) */
				for (i = 0; i < orderSize; i++) {
					var total_price = document.getElementById("product_total_price" + i).value;
					sub_total = parseInt(total_price) + parseInt(sub_total); 		
						
				}
				/* alert('total_price'+sub_total) */
				 document.getElementById("total_price").value = sub_total;
				}
			function clear()
			{   
			   document.getElementById("myForm").reset();
			}
			
				
			
		
		
			function orderCheck() {
				
				var total_checked_boxes = $("input:checkbox[name='row-check']:checked").length;
				
				var hidden = $('#upload input[type="hidden"]').length;
				
				var total = total_checked_boxes + hidden;
				console.log("hidden",hidden);
				
				if (total == 0) {
					document.getElementById("ordercheck").style.display = "block";
					$("#ordercheck").fadeIn(2);
					document.body.scrollTop = 0;
					document.documentElement.scrollTop = 0;
					return false;
				} else {
					$('input[name="btnOrder"]').attr("data-toggle", "modal");
					$('input[name="btnOrder"]').attr("data-target", "#confirm-submit");
				}
			}

			
			function closing() {
				document.getElementById("ordercheck").style.display = "none";
				return false;
			}
			
		
			
			var datatbstatus= "[[${data_tb}]]";  
			if(datatbstatus=="save"){
				$(document).ready(function() {
					var table=$('#list').DataTable({
						"lengthMenu" : [ 3, 5, 7, 9, 10 ],
						stateSave: true
					});
				
						$('.active').removeClass('active');
						$('#supplier_order_reg').addClass('active');
						
						$(function() {

							$("#btnOrder").on(
									"click",
									function() {
						      var form = this;

						      // Iterate over all checkboxes in the table
						      table.$('input[type="checkbox"]').each(function(){
						    	  
						         // If checkbox doesn't exist in DOM
						         if(!$.contains(document, this)){
						            // If checkbox is checked
						            
						            if(this.checked){
						               // Create a hidden element 
						               $(form).append(
						                  $('<input>')
						                     .attr('type', 'hidden')
						                     .attr('name', this.name)
						                     .attr('id','hid')
						                     .val(this.value)
						               );
						            }
						         } 
						      });
						    
						      orderCheck();
						      
						   });
						});
					var count=0;
					$(function() {

						// Header Master Checkbox Event
						$("#masterCheck").on(
								"click",
								function() {
									var form = this;
									
									if ($("input:checkbox").prop("checked")) {
										
										table.$('input[type="checkbox"]').each(function(){
										$(this).prop('checked',true);
										console.log(this);
										});
										
									} else {
										//$("input:checkbox[name='row-check']").prop("checked", false);
										table.$('input[type="checkbox"]').each(function(){
										$(this).prop('checked',false);
										});
									}
								});

						// Check event on each table row checkbox
						
						var form=this;
						$(this)
								.on(
										"change",
										function() {
												
											var allCount=0;
											var checkCount=0;
											table.$('input[type="checkbox"]').each(function(){
												allCount++;
												if(this.checked){
													checkCount++;
												}
												});

											console.log("allcount : ",allCount);
											console.log("checkcount : ",checkCount);
											// If all checked manually then check master checkbox
											if (allCount == checkCount) {
												$("#masterCheck").prop("checked", true);
											} else {
												$("#masterCheck").prop("checked", false);
											}
										});
					});
				
				});			
				
				
			} else {			
				$(document).ready(function() {
					var table=$('#list').DataTable({
						"lengthMenu" : [ 3, 5, 7, 9, 10 ],
						stateSave: true
					}).search( '' )
			        .columns().search( '' )
			        .draw();					
				});	
				
					$('.active').removeClass('active');
					$('#supplier_order_reg').addClass('active');
					
					$(function() {

						$("#btnOrder").on(
								"click",
								function() {
					      var form = this;

					      // Iterate over all checkboxes in the table
					      table.$('input[type="checkbox"]').each(function(){
					    	  
					         // If checkbox doesn't exist in DOM
					         if(!$.contains(document, this)){
					            // If checkbox is checked
					            
					            if(this.checked){
					               // Create a hidden element 
					               $(form).append(
					                  $('<input>')
					                     .attr('type', 'hidden')
					                     .attr('name', this.name)
					                     .attr('id','hid')
					                     .val(this.value)
					               );
					            }
					         } 
					      });
					    
					      orderCheck();
					      
					   });
					});
				var count=0;
				$(function() {

					// Header Master Checkbox Event
					$("#masterCheck").on(
							"click",
							function() {
								var form = this;
								
								if ($("input:checkbox").prop("checked")) {
									
									table.$('input[type="checkbox"]').each(function(){
									$(this).prop('checked',true);
									console.log(this);
									});
									
								} else {
									//$("input:checkbox[name='row-check']").prop("checked", false);
									table.$('input[type="checkbox"]').each(function(){
									$(this).prop('checked',false);
									});
								}
							});

					// Check event on each table row checkbox
					
					var form=this;
					$(this)
							.on(
									"change",
									function() {
											
										var allCount=0;
										var checkCount=0;
										table.$('input[type="checkbox"]').each(function(){
											allCount++;
											if(this.checked){
												checkCount++;
											}
											});

										console.log("allcount : ",allCount);
										console.log("checkcount : ",checkCount);
										// If all checked manually then check master checkbox
										if (allCount == checkCount) {
											$("#masterCheck").prop("checked", true);
										} else {
											$("#masterCheck").prop("checked", false);
										}
									});
				});
			
			}	
			
		</script>
			
</body>
</html>