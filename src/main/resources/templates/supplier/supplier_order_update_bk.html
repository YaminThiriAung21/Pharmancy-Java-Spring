<!DOCTYPE html>
<html  xmlns:th="http://www.thymeleaf.org"
 xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout" layout:decorator="common/admin_layout">
<head>
<meta charset="ISO-8859-1">
<title>Supplier Order Update</title>
</head>
<style>
$quantity-btn-color: #95d7fc;
.form-group {
	width: 10%;
	margin: 30px;
	input[type="text"] {
		width: 100%;
		text-align: right;
	}
	.glyphicon {
		color: $quantity-btn-color;
	}
}
</style>
<body>
<div class="col-lg-12" layout:fragment="content">
		<p id="errorMsg" th:if="${errormsg != null}" th:text="${errormsg}" class="sufee-alert alert with-close alert-success alert-dismissible fade show"></p>
		<p id="successMsg" th:if="${msg != null}" th:utext="${msg}" class="sufee-alert alert with-close alert-success alert-dismissible fade show"></p>
	<div class="col-lg-12">
		<div class="card">
	    	 <div class="card-header text-center">
	         	 <strong>Supplier Order </strong>Update 
	     	</div>
	     	<form th:action="@{${T(pec.datacode.AdminPageInfo).SUPPLIER_ORDER_UPDATE.url}}" id="myForm" method="get"  class="form-horizontal">
        	 
	          	<div class="card-body card-block" th:object="${supOrderInfoDto}">  
	          	<input type="hidden" th:name="supplier_order_info_id" th:value="*{supplier_order_info_id}">
	                <div class="row form-group">
	                	<div class="col col-md-3">
	                		<label for="select" class=" form-control-label">Supplier Name</label>
	                	</div>
	                	<div class="col-6 col-md-3">	                	
	                		<select class="form-control" th:field="*{supplier_info_id}">
	                			<option th:each="SDto:${supplierdropdown}" th:value="${SDto.supplier_info_id}" th:text="${SDto.supplier_name}" ></option>     
                            </select>
	                	</div>
	                </div>
	                <div class="row form-group">
	                    <div class="col col-md-3">
	                        <label for="hf-email" class=" form-control-label">Order Update Date:</label>
	                    </div>
	                    <div class="col-6 col-md-3">
	                        <input type="text" placeholder="yyyy-MM-dd" class="form-control"  readonly th:value="*{order_date}" th:field="*{order_date}" >
	                        
	                    </div>
	                    
	                    <div class="col col-md-3">
	                        <label for="hf-password" class=" form-control-label" >Order Received Date:</label>
	                    </div>
	                    <div class="col-12 col-md-3">
	                        <input type="date" placeholder="yyyy-MM-dd" class="form-control" th:field="*{orderReceiveDate}" th:value="*{order_receive_date}" onchange="clearErrorMsg()">
	                        <span class="help-block" id="orderReceiveDate_msg"></span>
	                    </div>
	                </div>
	                <input type="hidden" id="rowIndex" th:field="*{rowIndex}">
	                <br>
	                <div th:object="${supDetailOrderWrapperDto}">
	               
	                <div class="card-body card-block" th:each="dto, ind: *{supDetailOrderInfoDto}">
	                <input type="hidden" th:name="supDetailOrderInfoDto[__${ind.index}__].supplier_detail_order_info_id" th:value="${dto.supplier_detail_order_info_id}">
	                <input type="hidden" th:name="supDetailOrderInfoDto[__${ind.index}__].product_info_id" th:value="${dto.product_info_id}">
	                <input type="hidden" th:name="supDetailOrderInfoDto[__${ind.index}__].supplier_order_info_id" th:value="${dto.supplier_order_info_id}">
	                <div class="row form-group">
	                	<div class="col col-md-10">
	                		Product Order <label th:text=${ind.count}></label>
	                	</div>
	                	<div class="col col-md-2">
	  			  				<button type="submit" th:id="${ind.index}" name="remove" class="btn btn-danger btn-sm" onmouseover="clearErrorMsg()" onclick="return clearingcontent(this.id);" >Remove Order</button>
	                	</div>
	                </div>
	                <div class="row form-group">
	                    <div class="col col-md-3">
	                        <label for="hf-email" class=" form-control-label">Product Code:</label>
	                    </div>
	                    <div class="col-6 col-md-3">
	                        <input type="text" th:value="${dto.product_code}" th:id="product_code+${ind.index}" th:name="supDetailOrderInfoDto[__${ind.index}__].product_code" placeholder="(empty)" class="form-control" readonly>
	                        
	                    </div>	
	                    
	                    <div class="col col-md-3">
	                        <label for="hf-password" class=" form-control-label">Product Name:</label>
	                    </div>
	                    <div class="col-12 col-md-3">
	                        <input type="text" th:value="${dto.product_name}" th:id="product_name+${ind.index}" th:name="supDetailOrderInfoDto[__${ind.index}__].product_name" placeholder="(empty)" class="form-control" readonly>
	                        
	                    </div>
	                </div>
	                <div class="row form-group">
	                    <div class="col col-md-3">
	                        <label for="hf-email" class=" form-control-label">Category Type:</label>
	                    </div>
	                    <div class="col-6 col-md-3">
	                        <input type="text" th:value="${dto.category_name}" th:id="category_name+${ind.index}" th:name="supDetailOrderInfoDto[__${ind.index}__].category_name" placeholder="(empty)" class="form-control" readonly>
	                        
	                    </div>
	                    
	                    <div class="col col-md-3">
	                        <label for="hf-password" class=" form-control-label">Medicine Type:</label>
	                    </div>
	                    <div class="col-12 col-md-3">
	                        <input type="text" th:value="${dto.medicine_type}" th:id="medicine_type+${ind.index}" th:name="supDetailOrderInfoDto[__${ind.index}__].medicine_type" placeholder="(empty)" class="form-control" readonly>
	                        
	                    </div>
	                </div>
	                <div class="row form-group">
	                	<div class="col col-md-3">
	                        <label for="hf-email" class=" form-control-label">Packaging Type:</label>
	                    </div>
	                    <div class="col-6 col-md-3">
	                        <input type="text" th:value="${dto.packaging_type}" th:id="packaging_type+${ind.index}" th:name="supDetailOrderInfoDto[__${ind.index}__].packaging_type" placeholder="(empty)" class="form-control" readonly>
	                        
	                    </div>
	                </div>
	                
	                <br>
	                <div class="row form-group">
	                    <div class="col col-md-3">
	                        <label for="hf-email" class=" form-control-label">Product Quantity:</label>
	                    </div>
	                
	                	<div class="col-6 col-md-3">
              				<div class="input-group mb-3" style="max-width: 200px;">
                				<div class="input-group-prepend">
                  					<button class="btn btn-outline-primary"
										type="button" th:id="${ind.index}" onClick="minus_click(this.id)">&minus;</button>
                				</div>
                				<input type="text" class="form-control text-center" th:value="${dto.product_quantity}" placeholder="" readonly id="product_quantity"
                  					aria-label="Example text with button addon" aria-describedby="button-addon1" th:id= "product_quantity+ ${ind.index}"
                  					th:name="supDetailOrderInfoDto[__${ind.index}__].product_quantity">
                				<div class="input-group-append">
                  					<button class="btn btn-outline-primary"
										type="button" th:id="${ind.index}" onClick="plus_click(this.id)">&plus;</button>
                				</div>
              				</div>
            			</div>  
	                <!-- <div class="number">
						<span class="minus">-</span>
						<input type="text" value="1"/>
						<span class="plus">+</span>
					</div>  -->       
	                    <div class="col col-md-3">
	                        <label for="hf-password" class=" form-control-label">Product Price:</label>
	                    </div>
	                    <div class="col-12 col-md-3">
	                        <input type="text" th:value="${dto.product_price}" th:id= "product_price+ ${ind.index}"
                  					th:name="supDetailOrderInfoDto[__${ind.index}__].product_price" placeholder="Enter Product Price..." class="form-control" readonly>
	                        
	                    </div>
	                </div>
	                <input type="hidden" th:id="product_total_price+${ind.index}" 
	                 th:value="${dto.product_total_price}">
	                <div class="row form-group">
	               		 <div class="col col-md-3">
	                        	<label for="hf-password" class=" form-control-label" >Manufacture Date:</label>
	                     </div>
	                     <div class="col-6 col-md-3">
	                        <input type="date" placeholder="yyyy-MM-dd" th:id= "manufactureDate+${ind.index}"
                  					th:name="supDetailOrderInfoDto[__${ind.index}__].manufactureDate" th:value="${dto.manufactureDate}" class="form-control" onchange="clearErrorMsg()">
	                        <span class="help-block" th:id="manufactureDate_msg+${ind.index}"></span>
	                     </div>
	               
	                
	                    <div class="col col-md-3">
	                        <label for="hf-email" class=" form-control-label" >Expire Date:</label>
	                    </div>
	                    <div class="col-12 col-md-3">
	                        <input type="date" placeholder="yyyy-MM-dd" class="form-control" th:id= "expireDate+${ind.index}" onchange="clearErrorMsg()"
                  					th:name="supDetailOrderInfoDto[__${ind.index}__].expireDate" th:value="${dto.expireDate}" >
	                        <span class="help-block" th:id="expireDate_msg+${ind.index}"></span>
	                    </div>
	                 </div>                 
	                 </div>
	                 </div>
	                 <hr size=2 noshade>
	                 <div class="row form-group">
	                 		<div class="col col-md-3"></div>
	                 		<div class="col-6 col-md-3"></div>
	                 	<div class="col col-md-3">
	                        <label for="hf-email" class=" form-control-label">Total Price:</label>
	                    </div>
	                    <div class="col-12 col-md-3">
	                        <input type="text" id="totalPrice" placeholder="0" class="form-control" readonly th:field="*{total_price}">
	                        
	                    </div>
	                 </div>
	                 <div class="row form-group">
	                 
	                 <div class="col col-md-9"></div>
	               		 <div class="col-6 col-md-1">
	                        <button type="submit" name="update" class="btn btn-info btn-sm" onmouseover="clearErrorMsg()" onclick="return checkValidate()">Update</button>
	                     </div> 
	                    <div class="col-6 col-md-1">
	                        <a th:href="@{${T(pec.datacode.AdminPageInfo).SUPPLIER_ORDER_LIST.url}}"><button type="button" name="clear" class="btn btn-danger btn-info btn-sm" >Cancel</button></a>
	                    </div>
	                 </div>
	                 
	                 </div>
	                 </form>
               </div>
         	
     	</div>
      
	</div>   
	<script type="text/javascript" layout:fragment="scriptArea">
	  $(document).ready(function() {
			
			$('.active').removeClass('active');
			$('#supplier_order_list').addClass('active');

		});
         	function clearErrorMsg(){	
				var errorMsg = document.getElementById("errorMsg");
				var successMsg = document.getElementById("successMsg");
				if(errorMsg != null){
					document.getElementById("errorMsg").style.visibility = "hidden";
					document.getElementById("errorMsg").innerHTML = "";
					document.getElementById("errorMsg").classList.remove("alerterror");
				}
				if(successMsg != null){
					document.getElementById("successMsg").style.visibility = "hidden";
					document.getElementById("successMsg").innerHTML = "";
					document.getElementById("successMsg").classList.remove("alertsuccess");
				}
				document.getElementById("orderReceiveDate").style.borderColor = "";
				var orderSize="[[${orderListSize}]]";
				for (i = 0; i<orderSize; i++) {
					document.getElementById("manufactureDate"+i).style.borderColor = "";
					document.getElementById("expireDate"+i).style.borderColor = "";
				}
			} 
			 
			function checkValidate(){	
				var orderReceiveDateMsg="[[${E000034}]]";
				var manufactureDateMsg="[[${E000031}]]";
				var expireDateMsg="[[${E000032}]]";
				
				var orderReceiveDate = document.getElementById("orderReceiveDate").value.trim();
				if(orderReceiveDate == ""){
					document.getElementById("orderReceiveDate").style.borderColor = "red";
					document.getElementById("orderReceiveDate_msg").innerHTML = orderReceiveDateMsg;
				    return false;
				}
				
				var orderSize="[[${orderListSize}]]";
				
				for (i = 0; i<orderSize; i++) {
					document.getElementById("expireDate_msg"+i).innerHTML = "";
					var manufactureDate = document.getElementById("manufactureDate"+i).value.trim();
					
					var expireDate = document.getElementById("expireDate"+i).value.trim();
				
					if(manufactureDate== ""){
						
						document.getElementById("manufactureDate"+i).style.borderColor = "red";
						document.getElementById("manufactureDate_msg"+i).innerHTML = manufactureDateMsg;
						document.getElementById("orderReceiveDate_msg").innerHTML = "";
				    	return false;
					}
					else if(expireDate == ""){
						document.getElementById("expireDate"+i).style.borderColor = "red";
						document.getElementById("expireDate_msg"+i).innerHTML = expireDateMsg;
						document.getElementById("manufactureDate_msg"+i).innerHTML = "";
				    	return false;
					}
					
				}	
				return true;
			} 
         	
         	function clearingcontent(id){
				//alert('Remove ID'+id)
				document.getElementById("rowIndex").value = id;
				return true;
				
      		}
			
      		function clearing()
			{   
      			
      			$('#product_quantity').attr('value','');
      			$('#orderReceivedDate').attr('value','');
      			$('#manufactureDate').attr('value','');
      			$('#expiredDate').attr('value','');
		   	
			}
			
			
			function minus_click(clicked_id)
			{	
				var quan = document.getElementById("product_quantity" + clicked_id).value;
				//alert('Product QTY'+quan)
				if(quan > 1){
					//alert('Product QTY'+quan)
					document.getElementById("product_quantity" + clicked_id).value= parseInt(quan)-1 ;
				    var price = document.getElementById("product_price" + clicked_id).value;
				    //alert('Product Price'+price)
				    document.getElementById("product_total_price"+ clicked_id).value =  price;
					
				} 
				
				var sub_total = 0;
				var orderSize="[[${orderListSize}]]";	
				//alert('Order Size'+orderSize)
				for (i = 0; i < orderSize; i++) {
					var total_price = document.getElementById("product_total_price" + i).value;
					sub_total = parseInt(total_price) + parseInt(sub_total); 	
						
				}
				//alert('total_price'+sub_total)
				var total=document.getElementById("totalPrice").value;
				document.getElementById("totalPrice").value = parseInt(total)-parseInt(sub_total);

			}
				
			function plus_click(clicked_id)
			{	
				var quant = document.getElementById("product_quantity" + clicked_id).value;
				if(quant < 100){
					document.getElementById("product_quantity" + clicked_id).value= parseInt(quant)+1 ;
				    var price = document.getElementById("product_price" + clicked_id).value;
				    document.getElementById("product_total_price"+ clicked_id).value = price;
					
				}
				var sub_total = 0;
				var orderSize="[[${orderListSize}]]";	
				//alert('Order Size'+orderSize)
				for (i = 0; i < orderSize; i++) {
					var total_price = document.getElementById("product_total_price" + i).value;
					sub_total = parseInt(total_price) + parseInt(sub_total); 		
						
				}
				//alert('total_price'+sub_total)
				var total=document.getElementById("totalPrice").value;
				document.getElementById("totalPrice").value = parseInt(total)+parseInt(sub_total);
			}
			
		</script> 
                                        
</body>
</html>